<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRIPZY - Agency Dashboard</title>
    <meta name="theme-color" content="#0ea5e9">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Sora:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --sky-500: #0ea5e9; --sky-600: #0284c7; --sky-900: #0c4a6e;
            --coral: #f97316; --text-primary: #0c4a6e; --text-muted: #94a3b8;
            --danger: #ef4444; --success: #16a34a; --warning: #f59e0b;
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; height: 100%; }
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(180deg, #a8d4f5 0%, #d4e8f7 40%, #fce8d5 85%, #ffd9b3 100%);
            background-attachment: fixed; color: var(--text-primary);
            min-height: 100%; display: flex; flex-direction: column; overflow-x: hidden;
        }
        .font-display { font-family: 'Sora', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: rgba(14, 165, 233, 0.3); border-radius: 10px; }
        .bg-scene { position: fixed; inset: 0; z-index: -1; pointer-events: none; overflow: hidden; }
        .sun { position: absolute; width: 80px; height: 80px; top: 8%; right: 10%; background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><defs><radialGradient id="g1" cx="0.5" cy="0.5" r="0.5"><stop offset="0%" stop-color="%23FFF4B8"/><stop offset="70%" stop-color="%23FFD54F"/><stop offset="100%" stop-color="%23FFB74D"/></radialGradient></defs><circle cx="40" cy="40" r="35" fill="url(%23g1)"/></svg>') no-repeat center/contain; animation: sunGrow 10s ease-in-out infinite; will-change: transform; }
        @keyframes sunGrow { 0%, 100% { transform: scale(1); opacity: 0.9; } 50% { transform: scale(1.05); opacity: 1; } }
        .mountains { position: absolute; bottom: 0; left: 0; right: 0; height: 200px; pointer-events: none; background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none"><path fill="%23dce9f5" fill-opacity="0.6" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,197.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path><path fill="%23e8f1f8" fill-opacity="0.8" d="M0,288L60,277.3C120,267,240,245,360,234.7C480,224,600,224,720,234.7C840,245,960,267,1080,250.7C1200,235,1320,181,1380,154.7L1440,128L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>'); background-size: cover; background-position: bottom; }

        .card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 24px; box-shadow: 0 4px 20px rgba(14, 165, 233, 0.06); transition: all 0.35s ease; position: relative; overflow: hidden; }
        .card::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%; background: linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 100%); pointer-events: none; border-radius: 24px 24px 0 0; }
        .btn-primary { background: linear-gradient(135deg, var(--sky-500), var(--sky-600)); color: white; font-weight: 600; padding: 14px 28px; border-radius: 16px; border: none; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(14, 165, 233, 0.25); font-family: 'Outfit', sans-serif; font-size: 15px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; position: relative; overflow: hidden; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(14, 165, 233, 0.3); }
        .btn-secondary { background: rgba(255, 255, 255, 0.6); color: var(--sky-600); font-weight: 600; padding: 12px 24px; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.6); cursor: pointer; transition: all 0.2s ease; font-family: 'Outfit', sans-serif; font-size: 14px; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.8); }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); color: white; }
        .btn-icon { width: 48px; height: 48px; border-radius: 16px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.7); border: 1px solid rgba(255, 255, 255, 0.6); cursor: pointer; transition: all 0.2s ease; color: var(--sky-600); flex-shrink: 0; }
        .btn-icon:hover { background: rgba(255, 255, 255, 0.9); }
        .input-field { width: 100%; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 16px; padding: 14px 16px; font-size: 15px; color: var(--text-primary); transition: all 0.2s ease; font-family: 'Outfit', sans-serif; }
        .input-field:focus { outline: none; border-color: var(--sky-400); background: rgba(255, 255, 255, 0.9); }

        .app-page { display: none; opacity: 0; flex: 1 0 auto; width: 100%; }
        .app-page.active { display: flex; flex-direction: column; animation: pageEnter 0.4s ease forwards; }
        @keyframes pageEnter { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; z-index: 100; padding: 8px 16px; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
        .nav-container { max-width: 600px; margin: 0 auto; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 28px; padding: 8px; box-shadow: 0 8px 32px rgba(14, 165, 233, 0.08); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 10px 12px; border-radius: 18px; cursor: pointer; transition: all 0.2s ease; color: #94a3b8; background: transparent; border: none; font-family: 'Outfit', sans-serif; }
        .nav-item.active { color: var(--sky-600); background: rgba(14, 165, 233, 0.1); }
        .nav-item span { font-size: 10px; font-weight: 600; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(14, 165, 233, 0.2); backdrop-filter: blur(8px); z-index: 200; display: none; align-items: center; justify-content: center; padding: 16px; }
        .modal-overlay.active { display: flex; }
        .modal-content { width: 100%; max-width: 500px; max-height: 92vh; overflow-y: auto; background: rgba(255, 255, 255, 0.95); border: 1px solid rgba(255, 255, 255, 0.6); border-radius: 32px; transform: scale(0.9); opacity: 0; transition: all 0.35s cubic-bezier(0.32, 0.72, 0, 1); }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }

        .toast-container { position: fixed; top: 24px; left: 50%; transform: translateX(-50%); z-index: 300; width: calc(100% - 32px); max-width: 400px; }
        .toast { background: white; border-radius: 18px; padding: 16px 20px; box-shadow: 0 10px 30px rgba(14, 165, 233, 0.12); border-left: 4px solid var(--sky-500); display: flex; align-items: center; gap: 14px; transform: translateY(-150px); opacity: 0; transition: all 0.35s cubic-bezier(0.32, 0.72, 0, 1); }
        .toast.show { transform: translateY(0); opacity: 1; }
        
        .animate-in { animation: slideUp 0.5s ease forwards; opacity: 0; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .table-container { width: 100%; overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th { text-align: left; padding: 12px 16px; border-bottom: 2px solid rgba(14, 165, 233, 0.1); color: var(--text-muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 700; }
        .data-table td { padding: 16px; border-bottom: 1px solid rgba(14, 165, 233, 0.05); vertical-align: middle; }
        .data-table tbody tr:hover { background: rgba(14, 165, 233, 0.03); }

        .status-badge { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 600; }
        .status-active { background: rgba(22, 163, 74, 0.1); color: #16a34a; }
        .status-pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .status-cancelled { background: rgba(239, 68, 68, 0.1); color: #dc2626; }
        .status-income { background: rgba(22, 163, 74, 0.1); color: #16a34a; }
        .status-expense { background: rgba(239, 68, 68, 0.1); color: #dc2626; }

        .chart-card { position: relative; height: 250px; width: 100%; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        
        @media (min-width: 768px) {
            .stats-grid { grid-template-columns: repeat(4, 1fr); }
            .modal-content { border-radius: 32px; }
            .bottom-nav { left: 50%; transform: translateX(-50%); max-width: 768px; }
        }
    </style>
</head>
<body>
    <div class="bg-scene"><div class="sun"></div><div class="mountains"></div></div>
    <div class="toast-container"><div id="toast" class="toast"><div id="toastIcon"></div><span id="toastText" class="font-semibold text-sm flex-1"></span></div></div>

    <!-- LOGIN PAGE -->
    <div id="loginPage" class="app-page active min-h-screen flex items-center justify-center p-5">
        <div class="w-full max-w-md">
            <div class="text-center mb-10 animate-in">
                <div class="inline-flex items-center justify-center w-24 h-24 rounded-3xl card mb-6">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#0ea5e9" stroke-width="2.5"/><path d="M2 17L12 22L22 17" stroke="#0ea5e9" stroke-width="2.5"/><path d="M2 12L12 17L22 12" stroke="#f97316" stroke-width="2.5"/></svg>
                </div>
                <h1 class="font-display text-5xl font-bold bg-gradient-to-r from-sky-600 via-sky-500 to-orange-400 bg-clip-text text-transparent mb-3">TRIPZY</h1>
                <p class="text-sky-600 font-medium text-lg">Agency Dashboard</p>
            </div>
            <div class="card p-8 animate-in delay-1">
                <h2 class="font-display text-2xl font-bold text-center mb-8 text-sky-900">Login Admin</h2>
                <div class="mb-5"><label class="text-xs font-bold text-sky-700 uppercase tracking-wider mb-2 block">Email</label><input type="email" id="loginEmail" class="input-field" placeholder="admin@email.com" value="admin@tripzy.com"></div>
                <div class="mb-8"><label class="text-xs font-bold text-sky-700 uppercase tracking-wider mb-2 block">Password</label><input type="password" id="loginPassword" class="input-field" placeholder="Masukkan password" value="admin123"></div>
                <button class="btn-primary w-full" onclick="handleLogin()">Masuk Dashboard</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4">
            <div class="card flex items-center justify-between px-5 py-4">
                <div><h1 class="font-bold text-sky-900 text-lg">TRIPZY Agency</h1><p class="text-sky-400 text-xs font-medium">Welcome back, Admin</p></div>
                <button class="btn-icon" onclick="showToast('Notifikasi')"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></button>
            </div>
        </header>
        <div class="px-5 space-y-6" id="homeContent"></div>
    </div>

    <!-- TRIPS PAGE -->
    <div id="tripsPage" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4"><div class="card px-5 py-4 flex items-center justify-between"><h1 class="font-display text-2xl font-bold text-sky-900">Trip Management</h1><button class="btn-primary py-2 px-4 text-sm" onclick="openTripModal()">+ Trip Baru</button></div></header>
        <div class="px-5" id="tripsContent"></div>
    </div>

    <!-- BOOKINGS PAGE -->
    <div id="bookingsPage" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4"><div class="card px-5 py-4"><h1 class="font-display text-2xl font-bold text-sky-900">Daftar Booking</h1></div></header>
        <div class="px-5" id="bookingsContent"></div>
    </div>

    <!-- GUIDES PAGE -->
    <div id="guidesPage" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4"><div class="card px-5 py-4 flex items-center justify-between"><h1 class="font-display text-2xl font-bold text-sky-900">Manajemen Guide</h1><button class="btn-primary py-2 px-4 text-sm" onclick="showToast('Fitur tambah guide')">+ Guide</button></div></header>
        <div class="px-5" id="guidesContent"></div>
    </div>

    <!-- REPORTS PAGE (NEW) -->
    <div id="reportsPage" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4"><div class="card px-5 py-4"><h1 class="font-display text-2xl font-bold text-sky-900">Laporan Keuangan</h1></div></header>
        <div class="px-5" id="reportsContent"></div>
    </div>

    <!-- PROFILE PAGE -->
    <div id="profilePage" class="app-page pb-24">
        <header class="sticky top-0 z-50 px-5 py-4"><div class="card px-5 py-4"><h1 class="font-display text-2xl font-bold text-sky-900">Pengaturan</h1></div></header>
        <div class="px-5" id="profileContent"></div>
    </div>

    <!-- BOTTOM NAV -->
    <nav id="bottomNav" class="bottom-nav hidden">
        <div class="nav-container">
            <div class="flex items-center justify-around">
                <button class="nav-item active" data-page="mainApp" onclick="navigate('mainApp')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>Dashboard</span></button>
                <button class="nav-item" data-page="tripsPage" onclick="navigate('tripsPage')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg><span>Trips</span></button>
                <button class="nav-item" data-page="bookingsPage" onclick="navigate('bookingsPage')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg><span>Booking</span></button>
                <button class="nav-item" data-page="reportsPage" onclick="navigate('reportsPage')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg><span>Laporan</span></button>
                <button class="nav-item" data-page="profilePage" onclick="navigate('profilePage')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6"/></svg><span>Lainnya</span></button>
            </div>
        </div>
    </nav>

    <!-- MODAL TRIP -->
    <div id="tripModal" class="modal-overlay" onclick="closeOnOverlay(event, 'tripModal')">
        <div class="modal-content p-6 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-display text-xl font-bold text-sky-900" id="tripModalTitle">Tambah Trip Baru</h2>
                <button class="btn-icon" onclick="closeModal('tripModal')"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
            </div>
            <form onsubmit="saveTrip(event)" class="space-y-4">
                <input type="hidden" id="tripId">
                <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">Nama Trip</label><input type="text" id="tripName" class="input-field" required placeholder="e.g. Bali Cultural Trip"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">Lokasi</label><input type="text" id="tripLocation" class="input-field" required placeholder="Bali"></div>
                    <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">Harga (Rp)</label><input type="number" id="tripPrice" class="input-field" required placeholder="4500000"></div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">Durasi</label><input type="text" id="tripDuration" class="input-field" required placeholder="3D2N"></div>
                    <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">Kategori</label><select id="tripCategory" class="input-field"><option>Pantai</option><option>Gunung</option><option>Budaya</option><option>Adventure</option></select></div>
                </div>
                <div><label class="text-xs font-bold text-sky-700 uppercase mb-1 block">URL Gambar</label><input type="url" id="tripImage" class="input-field" required placeholder="https://..."></div>
                <div class="flex gap-3 pt-4"><button type="button" class="flex-1 btn-secondary" onclick="closeModal('tripModal')">Batal</button><button type="submit" class="flex-1 btn-primary">Simpan</button></div>
            </form>
        </div>
    </div>

    <script>
        // STATE
        let state = {
            trips: [
                { id: 1, name: 'Bali Cultural Trip', location: 'Bali', price: 4500000, duration: '3D2N', category: 'Budaya', status: 'active', image: 'https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=400&h=300&fit=crop' },
                { id: 2, name: 'Raja Ampat Dive', location: 'Papua', price: 15000000, duration: '5D4N', category: 'Pantai', status: 'active', image: 'https://images.unsplash.com/photo-1506929562872-bb421503ef21?w=400&h=300&fit=crop' },
                { id: 3, name: 'Bromo Sunrise', location: 'Jawa Timur', price: 3500000, duration: '2D1N', category: 'Gunung', status: 'draft', image: 'https://images.unsplash.com/photo-1588668214407-6ea9a6d8c272?w=400&h=300&fit=crop' },
            ],
            bookings: [
                { id: 'B001', customer: 'Nanda Arianto', trip: 'Bali Cultural Trip', tripId: 1, date: '15-17 Des 2024', amount: 9000000, status: 'confirmed', pax: 2 },
                { id: 'B002', customer: 'Rina Wati', trip: 'Raja Ampat Dive', tripId: 2, date: '20-25 Des 2024', amount: 15000000, status: 'pending', pax: 1 },
                { id: 'B003', customer: 'Budi S', trip: 'Bromo Sunrise', tripId: 3, date: '10 Des 2024', amount: 3500000, status: 'cancelled', pax: 1 },
                { id: 'B004', customer: 'Sari Dewi', trip: 'Bali Cultural Trip', tripId: 1, date: '01-03 Jan 2025', amount: 4500000, status: 'confirmed', pax: 1 },
            ],
            expenses: [
                { id: 'E001', desc: 'Gaji Guide November', amount: 15000000, date: '30 Nov 2024', category: 'Operasional' },
                { id: 'E002', desc: 'Iklan Marketing', amount: 5000000, date: '15 Nov 2024', category: 'Marketing' },
                { id: 'E003', desc: 'Sewa Kantor', amount: 8000000, date: '01 Nov 2024', category: 'Operasional' },
                { id: 'E004', desc: 'Gaji Guide Desember', amount: 18000000, date: '28 Des 2024', category: 'Operasional' },
            ],
            guides: [
                { id: 1, name: 'Tomi Ariyanto', status: 'online', rating: 4.9, trips: 45, specialization: 'Budaya & Sejarah', avatar: 'https://i.pravatar.cc/100?img=12' },
                { id: 2, name: 'Sari Dewi', status: 'busy', rating: 4.8, trips: 32, specialization: 'Adventure', avatar: 'https://i.pravatar.cc/100?img=45' },
            ],
            nextTripId: 4
        };

        let revenueChart = null;
        let reportChart1 = null;
        let reportChart2 = null;

        // LOGIN
        function handleLogin() {
            const email = document.getElementById('loginEmail').value; const pass = document.getElementById('loginPassword').value;
            if (!email || !pass) { showToast('Isi email & password', 'warning'); return; }
            document.getElementById('loginPage').classList.remove('active'); document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').classList.add('active'); document.getElementById('mainApp').style.opacity = 1;
            document.getElementById('bottomNav').classList.remove('hidden');
            window.scrollTo(0, 0); renderHome(); showToast('Selamat datang Admin!', 'success');
        }
        function handleLogout() { document.querySelectorAll('.app-page').forEach(p => { p.classList.remove('active'); p.style.display = 'none'; }); document.getElementById('bottomNav').classList.add('hidden'); document.getElementById('loginPage').style.display = 'flex'; document.getElementById('loginPage').classList.add('active'); }

        // NAV
        function navigate(pageId) {
            document.querySelectorAll('.app-page').forEach(p => { p.classList.remove('active'); p.style.opacity = 0; });
            document.getElementById(pageId).classList.add('active'); document.getElementById(pageId).style.opacity = 1;
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`.nav-item[data-page="${pageId}"]`)?.classList.add('active');
            window.scrollTo(0, 0);
            
            if (pageId === 'mainApp') renderHome();
            else if (pageId === 'tripsPage') renderTrips();
            else if (pageId === 'bookingsPage') renderBookings();
            else if (pageId === 'guidesPage') renderGuides();
            else if (pageId === 'reportsPage') renderReports();
            else if (pageId === 'profilePage') renderProfile();
        }

        // RENDER DASHBOARD
        function renderHome() {
            const totalRevenue = state.bookings.filter(b => b.status === 'confirmed').reduce((a, b) => a + b.amount, 0);
            const activeTrips = state.trips.filter(t => t.status === 'active').length;
            const totalGuides = state.guides.length;
            const pendingBookings = state.bookings.filter(b => b.status === 'pending').length;

            document.getElementById('homeContent').innerHTML = `
                <div class="stats-grid animate-in">
                    <div class="card p-4 flex flex-col justify-between"><div class="flex items-center justify-between mb-2"><span class="text-sky-400 text-xs font-bold uppercase">Revenue</span><span class="w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></span></div><p class="text-2xl font-bold text-sky-900">${formatPrice(totalRevenue)}</p><p class="text-xs text-green-500 mt-1">+12% dari bulan lalu</p></div>
                    <div class="card p-4 flex flex-col justify-between"><div class="flex items-center justify-between mb-2"><span class="text-sky-400 text-xs font-bold uppercase">Active Trips</span><span class="w-8 h-8 rounded-lg bg-sky-100 flex items-center justify-center"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg></span></div><p class="text-2xl font-bold text-sky-900">${activeTrips}</p><p class="text-xs text-sky-400 mt-1">Packages</p></div>
                    <div class="card p-4 flex flex-col justify-between"><div class="flex items-center justify-between mb-2"><span class="text-sky-400 text-xs font-bold uppercase">Total Guides</span><span class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9333ea" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span></div><p class="text-2xl font-bold text-sky-900">${totalGuides}</p><p class="text-xs text-sky-400 mt-1">Available</p></div>
                    <div class="card p-4 flex flex-col justify-between"><div class="flex items-center justify-between mb-2"><span class="text-sky-400 text-xs font-bold uppercase">Pending</span><span class="w-8 h-8 rounded-lg bg-orange-100 flex items-center justify-center"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span></div><p class="text-2xl font-bold text-sky-900">${pendingBookings}</p><p class="text-xs text-orange-500 mt-1">Needs action</p></div>
                </div>
                <div class="card p-5 animate-in delay-1">
                    <div class="flex items-center justify-between mb-4"><h3 class="font-bold text-sky-900">Pendapatan (6 Bulan)</h3><button class="text-xs text-sky-500 font-semibold" onclick="navigate('reportsPage')">Lihat Detail</button></div>
                    <div class="chart-card"><canvas id="revenueChart"></canvas></div>
                </div>
                <div class="card p-5 animate-in delay-2">
                    <h3 class="font-bold text-sky-900 mb-4">Booking Terbaru</h3>
                    <div class="space-y-3">
                        ${state.bookings.slice(0, 3).map(b => `<div class="flex items-center justify-between py-2 border-b border-sky-50 last:border-0"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-sky-100 flex items-center justify-center font-bold text-sky-600">${b.customer.charAt(0)}</div><div><p class="font-semibold text-sm text-sky-800">${b.customer}</p><p class="text-xs text-sky-400">${b.trip}</p></div></div><span class="status-badge status-${b.status}">${b.status}</span></div>`).join('')}
                    </div>
                </div>
            `;
            initChart('revenueChart', [12000000, 19000000, 15000000, 25000000, 22000000, 28500000], 'line');
        }

        // RENDER REPORTS (NEW FEATURE)
        function renderReports() {
            const totalIncome = state.bookings.filter(b => b.status === 'confirmed').reduce((a, b) => a + b.amount, 0);
            const totalExpense = state.expenses.reduce((a, b) => a + b.amount, 0);
            const netProfit = totalIncome - totalExpense;

            document.getElementById('reportsContent').innerHTML = `
                <div class="animate-in">
                    <div class="flex items-center gap-3 mb-4">
                        <select class="input-field py-2 w-32" onchange="updateReportPeriod(this.value)">
                            <option value="2024">Tahun 2024</option>
                            <option value="2023">Tahun 2023</option>
                        </select>
                        <button class="btn-secondary py-2 px-4 text-sm" onclick="downloadReport()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Download</button>
                    </div>
                </div>

                <div class="stats-grid animate-in delay-1">
                    <div class="card p-4"><p class="text-xs text-sky-400 font-bold uppercase mb-1">Pemasukan</p><p class="text-2xl font-bold text-green-600">${formatPrice(totalIncome)}</p></div>
                    <div class="card p-4"><p class="text-xs text-sky-400 font-bold uppercase mb-1">Pengeluaran</p><p class="text-2xl font-bold text-red-500">${formatPrice(totalExpense)}</p></div>
                </div>

                <div class="card p-4 animate-in delay-2 mt-4">
                    <h3 class="font-bold text-sky-900 mb-4">Perbandingan Pemasukan vs Pengeluaran</h3>
                    <div class="chart-card"><canvas id="reportChart1"></canvas></div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div class="card p-4 animate-in delay-3">
                        <h3 class="font-bold text-sky-900 mb-4">Sumber Pendapatan</h3>
                        <div class="h-48 flex items-center justify-center"><div style="width: 180px; height: 180px;"><canvas id="reportChart2"></canvas></div></div>
                    </div>
                    <div class="card p-4 animate-in delay-3">
                        <h3 class="font-bold text-sky-900 mb-4">Ringkasan Profit</h3>
                        <div class="flex flex-col justify-center h-48">
                             <div class="text-center p-6 rounded-2xl ${netProfit >= 0 ? 'bg-green-50' : 'bg-red-50'}">
                                <p class="text-sm font-medium ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">Net Profit</p>
                                <p class="text-4xl font-bold ${netProfit >= 0 ? 'text-green-700' : 'text-red-600'}">${formatPrice(netProfit)}</p>
                                <p class="text-xs mt-2 text-sky-500">${netProfit >= 0 ? 'Profit' : 'Loss'} ${((netProfit/totalIncome)*100).toFixed(1)}%</p>
                             </div>
                        </div>
                    </div>
                </div>

                <div class="card p-4 animate-in delay-4 mt-4">
                    <h3 class="font-bold text-sky-900 mb-4">Riwayat Transaksi</h3>
                    <div class="table-container"><table class="data-table"><thead><tr><th>Tanggal</th><th>Keterangan</th><th>Kategori</th><th>Jumlah</th></tr></thead><tbody>
                        ${[...state.bookings.filter(b => b.status === 'confirmed').map(b => ({ date: b.date.split(' ')[0], desc: `Booking: ${b.trip} (${b.customer})`, amount: b.amount, type: 'income' })), ...state.expenses.map(e => ({ date: e.date, desc: e.desc, amount: e.amount, type: 'expense', category: e.category }))].sort((a,b) => new Date(b.date) - new Date(a.date)).map(t => `
                            <tr>
                                <td class="text-sm">${t.date}</td>
                                <td>${t.desc}</td>
                                <td><span class="text-xs px-2 py-1 rounded bg-sky-100 text-sky-700">${t.category || 'Booking'}</span></td>
                                <td class="font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-500'}">${t.type === 'income' ? '+' : '-'} ${formatPrice(t.amount)}</td>
                            </tr>
                        `).join('')}
                    </tbody></table></div>
                </div>
            `;

            // Init Charts
            initChart('reportChart1', [12, 19, 15, 25, 22, 28.5], 'bar', [8, 10, 9, 12, 11, 15]);
            initPieChart();
        }

        function initChart(id, data, type, data2 = null) {
            const ctx = document.getElementById(id);
            if(!ctx) return;
            const chart = Chart.getChart(id); if(chart) chart.destroy();
            
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 250);
            gradient.addColorStop(0, 'rgba(14, 165, 233, 0.3)');
            gradient.addColorStop(1, 'rgba(14, 165, 233, 0.0)');

            const datasets = type === 'bar' ? [
                { label: 'Pemasukan', data: data, backgroundColor: 'rgba(22, 163, 74, 0.6)', borderColor: '#16a34a', borderWidth: 2, borderRadius: 8 },
                { label: 'Pengeluaran', data: data2, backgroundColor: 'rgba(239, 68, 68, 0.6)', borderColor: '#ef4444', borderWidth: 2, borderRadius: 8 }
            ] : [{
                label: 'Revenue', data: data, borderColor: '#0ea5e9', backgroundColor: gradient, borderWidth: 3, fill: true, tension: 0.4
            }];

            new Chart(ctx, {
                type: type,
                data: { labels: ['Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'], datasets: datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: type === 'bar', position: 'bottom' } },
                    scales: { y: { beginAtZero: true, grid: { color: 'rgba(14, 165, 233, 0.05)' }, ticks: { callback: value => type === 'line' ? 'Rp ' + (value/1000000) + 'jt' : value } }, x: { grid: { display: false } } }
                }
            });
        }

        function initPieChart() {
            const ctx = document.getElementById('reportChart2');
            if(!ctx) return;
            const chart = Chart.getChart('reportChart2'); if(chart) chart.destroy();
            
            // Calculate income by trip
            const tripIncomes = {};
            state.bookings.filter(b => b.status === 'confirmed').forEach(b => {
                const trip = state.trips.find(t => t.id === b.tripId);
                const name = trip ? trip.name : 'Lainnya';
                tripIncomes[name] = (tripIncomes[name] || 0) + b.amount;
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(tripIncomes),
                    datasets: [{
                        data: Object.values(tripIncomes),
                        backgroundColor: ['#0ea5e9', '#f97316', '#16a34a', '#8b5cf6', '#ec4899'],
                        borderWidth: 2, borderColor: '#ffffff'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true, position: 'bottom' } } }
            });
        }

        function updateReportPeriod(val) { showToast(`Menampilkan laporan tahun ${val}`, 'success'); renderReports(); }
        function downloadReport() { showToast('Mengunduh laporan... (Demo)', 'success'); }

        // RENDER TRIPS
        function renderTrips() {
            document.getElementById('tripsContent').innerHTML = `
                <div class="table-container card p-4 mt-2">
                    <table class="data-table">
                        <thead><tr><th>Trip</th><th>Lokasi</th><th>Harga</th><th>Status</th><th>Aksi</th></tr></thead>
                        <tbody>
                            ${state.trips.map(t => `<tr>
                                <td><div class="flex items-center gap-3"><img src="${t.image}" class="w-10 h-10 rounded-lg object-cover"><div><p class="font-semibold">${t.name}</p><p class="text-xs text-sky-400">${t.duration}</p></div></div></td>
                                <td>${t.location}</td>
                                <td class="font-semibold">${formatPrice(t.price)}</td>
                                <td><span class="status-badge status-${t.status === 'active' ? 'active' : 'pending'}">${t.status}</span></td>
                                <td><div class="flex gap-2"><button class="btn-secondary py-1 px-3 text-xs" onclick="editTrip(${t.id})">Edit</button><button class="btn-danger py-1 px-3 text-xs" onclick="deleteTrip(${t.id})">Hapus</button></div></td>
                            </tr>`).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // TRIP CRUD
        function openTripModal(id = null) {
            const modal = document.getElementById('tripModal');
            document.getElementById('tripModalTitle').textContent = id ? 'Edit Trip' : 'Tambah Trip Baru';
            document.getElementById('tripId').value = id || '';
            document.getElementById('tripName').value = ''; document.getElementById('tripLocation').value = '';
            document.getElementById('tripPrice').value = ''; document.getElementById('tripDuration').value = '';
            document.getElementById('tripImage').value = '';

            if (id) {
                const trip = state.trips.find(t => t.id === id);
                if(trip) {
                    document.getElementById('tripName').value = trip.name;
                    document.getElementById('tripLocation').value = trip.location;
                    document.getElementById('tripPrice').value = trip.price;
                    document.getElementById('tripDuration').value = trip.duration;
                    document.getElementById('tripCategory').value = trip.category;
                    document.getElementById('tripImage').value = trip.image;
                }
            }
            openModal('tripModal');
        }

        function saveTrip(e) {
            e.preventDefault();
            const id = document.getElementById('tripId').value;
            const tripData = {
                name: document.getElementById('tripName').value, location: document.getElementById('tripLocation').value,
                price: parseInt(document.getElementById('tripPrice').value), duration: document.getElementById('tripDuration').value,
                category: document.getElementById('tripCategory').value, image: document.getElementById('tripImage').value, status: 'active'
            };

            if (id) { const index = state.trips.findIndex(t => t.id === parseInt(id)); state.trips[index] = { ...state.trips[index], ...tripData }; showToast('Trip berhasil diupdate!', 'success'); }
            else { state.trips.push({ id: state.nextTripId++, ...tripData }); showToast('Trip baru berhasil ditambahkan!', 'success'); }
            closeModal('tripModal'); renderTrips();
        }
        function editTrip(id) { openTripModal(id); }
        function deleteTrip(id) { if(confirm('Yakin hapus?')) { state.trips = state.trips.filter(t => t.id !== id); renderTrips(); showToast('Trip dihapus', 'success'); } }

        // RENDER BOOKINGS
        function renderBookings() {
            document.getElementById('bookingsContent').innerHTML = `
                <div class="table-container card p-4 mt-2">
                    <table class="data-table">
                        <thead><tr><th>ID</th><th>Customer</th><th>Trip</th><th>Total</th><th>Status</th><th>Aksi</th></tr></thead>
                        <tbody>
                            ${state.bookings.map(b => `<tr>
                                <td class="font-mono text-xs">${b.id}</td>
                                <td class="font-semibold">${b.customer}</td>
                                <td>${b.trip}</td>
                                <td class="font-semibold">${formatPrice(b.amount)}</td>
                                <td><span class="status-badge status-${b.status}">${b.status}</span></td>
                                <td>
                                    <div class="flex gap-2">
                                        ${b.status === 'pending' ? `<button class="btn-secondary py-1 px-2 text-xs" onclick="updateBooking('${b.id}', 'confirmed')">Confirm</button><button class="btn-danger py-1 px-2 text-xs" onclick="updateBooking('${b.id}', 'cancelled')">Cancel</button>` : `<span class="text-xs text-sky-400">-</span>`}
                                    </div>
                                </td>
                            </tr>`).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        function updateBooking(id, status) { const index = state.bookings.findIndex(b => b.id === id); state.bookings[index].status = status; renderBookings(); renderHome(); showToast(`Booking ${id} ${status}`, 'success'); }

        // RENDER GUIDES
        function renderGuides() {
            const statusColor = { online: 'bg-green-500', busy: 'bg-yellow-500', offline: 'bg-gray-400' };
            document.getElementById('guidesContent').innerHTML = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">${state.guides.map(g => `<div class="card p-4 flex items-center gap-4"><div class="relative"><img src="${g.avatar}" class="w-16 h-16 rounded-full object-cover"><span class="absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-white ${statusColor[g.status]}"></span></div><div class="flex-1"><h3 class="font-bold text-sky-900">${g.name}</h3><p class="text-xs text-sky-500">${g.specialization}</p><div class="flex items-center gap-4 mt-2"><div class="flex items-center gap-1 text-xs"><svg width="12" height="12" fill="#fbbf24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg><span class="font-bold">${g.rating}</span></div><span class="text-xs text-sky-400">${g.trips} trips</span></div></div></div>`).join('')}</div>`;
        }

        // RENDER PROFILE
        function renderProfile() {
            document.getElementById('profileContent').innerHTML = `
                <div class="card p-6 animate-in">
                    <h2 class="font-bold text-lg mb-4 text-sky-900">Pengaturan Akun</h2>
                    <div class="space-y-3">
                        <button class="w-full text-left p-4 rounded-xl bg-sky-50/50 flex items-center justify-between" onclick="showToast('Fitur belum tersedia')"><span class="font-medium">Edit Profil Perusahaan</span><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
                    </div>
                </div>
                <button class="w-full mt-6 py-4 rounded-2xl border-2 border-red-200 bg-white/30 text-red-500 font-bold hover:bg-red-50 transition animate-in delay-1" onclick="handleLogout()">Keluar</button>
            `;
        }

        // UTILS
        function formatPrice(p) { return 'Rp ' + p.toLocaleString('id-ID'); }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function closeOnOverlay(e, id) { if (e.target.id === id) closeModal(id); }
        function showToast(m, t = 'success') { const toast = document.getElementById('toast'); document.getElementById('toastText').textContent = m; document.getElementById('toastIcon').innerHTML = t === 'success' ? '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>' : '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'; toast.className = `toast ${t}`; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
    </script>
</body>
</html>